df <- read.table(text="
           DateTime,      Val
                 2017-06-13 00:00:00,5651.000
                 2017-06-13 01:00:00,5937.000
                 2017-06-13 02:00:00,5910.000
                 2017-06-13 03:00:00,5778.000
                 2017-06-13 04:00:00,5784.000
                 2017-06-13 05:00:00,5368.000
                 2017-06-13 06:00:00,5507.000
                 2017-06-13 07:00:00,5720.000
                 2017-06-13 08:00:00,6310.000
                 2017-06-13 09:00:00,6497.000
                 2017-06-13 10:00:00,6662.000
                 2017-06-13 11:00:00,6502.000
                 2017-06-13 12:00:00,6400.000
                 2017-06-13 13:00:00,6823.000
                 2017-06-13 14:00:00,6920.000
                 2017-06-13 15:00:00,6542.000
                 2017-06-13 16:00:00,6546.000
                 2017-06-13 17:00:00,5677.000
                 2017-06-13 18:00:00,5771.000
                 2017-06-13 19:00:00,5982.000
                 2017-06-13 20:00:00,6008.000
                 2017-06-13 21:00:00,6152.000
                 2017-06-13 22:00:00,6080.000
                 2017-06-13 23:00:00,5879.000
                 2017-06-14 00:00:00,5760.000
                 2017-06-14 01:00:00,5872.000
                 2017-06-14 02:00:00,5961.000
                 2017-06-14 03:00:00,5782.000
                 2017-06-14 04:00:00,5860.000
                 2017-06-14 05:00:00,5361.000
                 2017-06-14 06:00:00,5567.000
                 2017-06-14 07:00:00,5864.000
                 2017-06-14 08:00:00,6349.000
                 2017-06-14 09:00:00,6556.000
                 2017-06-14 10:00:00,6646.000
                 2017-06-14 11:00:00,6572.000
                 2017-06-14 12:00:00,6610.000
                 2017-06-14 13:00:00,6612.000
                 2017-06-14 14:00:00,6844.000
                 2017-06-14 15:00:00,6717.000
                 2017-06-14 16:00:00,6919.500
                 2017-06-14 17:00:00,6294.500
                 2017-06-14 18:00:00,5573.000
                 2017-06-14 19:00:00,5993.000
                 2017-06-14 20:00:00,6053.000
                 2017-06-14 21:00:00,6102.000
                 2017-06-14 22:00:00,6159.000
                 2017-06-14 23:00:00,6047.000
                 2017-06-15 00:00:00,5882.000
                 2017-06-15 01:00:00,5973.000
                 2017-06-15 02:00:00,6082.000
                 2017-06-15 03:00:00,5994.000
                 2017-06-15 04:00:00,5904.000
                 2017-06-15 05:00:00,5409.000
                 2017-06-15 06:00:00,5511.000
                 2017-06-15 07:00:00,5771.000
                 2017-06-15 08:00:00,6363.000
                 2017-06-15 09:00:00,6559.000
                 2017-06-15 10:00:00,6838.000
                 2017-06-15 11:00:00,6659.000
                 2017-06-15 12:00:00,6426.000
                 2017-06-15 13:00:00,6909.000
                 2017-06-15 14:00:00,6879.000
                 2017-06-15 15:00:00,6837.000
                 2017-06-15 16:00:00,6813.000
                 2017-06-15 17:00:00,6007.000
                 2017-06-15 18:00:00,6046.000
                 2017-06-15 19:00:00,6088.000
                 2017-06-15 20:00:00,6281.000
                 2017-06-15 21:00:00,6345.000
                 2017-06-15 22:00:00,6319.000
                 2017-06-15 23:00:00,6063.000
                 2017-06-16 00:00:00,5897.000
                 2017-06-16 01:00:00,6113.000
                 2017-06-16 02:00:00,6198.000
                 2017-06-16 03:00:00,6029.000
                 2017-06-16 04:00:00,5970.000
                 2017-06-16 05:00:00,5486.000
                 2017-06-16 06:00:00,5621.000
                 2017-06-16 07:00:00,5885.000
                 2017-06-16 08:00:00,6440.000
                 2017-06-16 09:00:00,6604.000
                 2017-06-16 10:00:00,6731.000
                 2017-06-16 11:00:00,6523.000
                 2017-06-16 12:00:00,6411.000
                 2017-06-16 13:00:00,6882.000
                 2017-06-16 14:00:00,6908.000
                 2017-06-16 15:00:00,6843.000
                 2017-06-16 16:00:00,6791.000
                 2017-06-16 17:00:00,5324.000
                 2017-06-16 18:00:00,5207.000
                 2017-06-16 19:00:00,5323.000
                 2017-06-16 20:00:00,6186.000
                 2017-06-16 21:00:00,6278.000
                 2017-06-16 22:00:00,6156.000
                 2017-06-16 23:00:00,6001.000
                 2017-06-17 00:00:00,5884.000
                 2017-06-17 01:00:00,6016.000
                 2017-06-17 02:00:00,5959.000
                 2017-06-17 03:00:00,5804.000
                 2017-06-17 04:00:00,5669.000
                 2017-06-17 05:00:00,4760.000
                 2017-06-17 06:00:00,4588.000
                 2017-06-17 07:00:00,4428.000
                 2017-06-17 08:00:00,4602.000
                 2017-06-17 09:00:00,4762.000
                 2017-06-17 10:00:00,4912.000
                 2017-06-17 11:00:00,4828.000
                 2017-06-17 12:00:00,4828.000
                 2017-06-17 13:00:00,4970.250
                 2017-06-17 14:00:00,4997.250
                 2017-06-17 15:00:00,4914.250
                 2017-06-17 16:00:00,4933.250
                 2017-06-17 17:00:00,4753.000
                 2017-06-17 18:00:00,4712.000
                 2017-06-17 19:00:00,3910.000
                 2017-06-17 20:00:00,3625.000
                 2017-06-17 21:00:00,3398.000
                 2017-06-17 22:00:00,3379.000
                 2017-06-17 23:00:00,3309.000
                 2017-06-18 00:00:00,3313.000
                 2017-06-18 01:00:00,3291.000
                 2017-06-18 02:00:00,3289.000
                 2017-06-18 03:00:00,3287.000
                 2017-06-18 04:00:00,3263.000
                 2017-06-18 05:00:00,3220.000
                 2017-06-18 06:00:00,3215.000
                 2017-06-18 07:00:00,2311.000
                 2017-06-18 08:00:00,1804.000
                 2017-06-18 09:00:00,1126.000
                 2017-06-18 10:00:00,931.000
                 2017-06-18 11:00:00,944.500
                 2017-06-18 12:00:00,965.500
                 2017-06-18 13:00:00,951.000
                 2017-06-18 14:00:00,972.000
                 2017-06-18 15:00:00,963.000
                 2017-06-18 16:00:00,949.000
                 2017-06-18 17:00:00,948.000
                 2017-06-18 18:00:00,941.000
                 2017-06-18 19:00:00,938.000
                 2017-06-18 20:00:00,932.000
                 2017-06-18 21:00:00,922.000
                 2017-06-18 22:00:00,935.000
                 2017-06-18 23:00:00,1011.231
                 2017-06-19 00:00:00,1022.231
                 2017-06-19 01:00:00,1017.231
                 2017-06-19 02:00:00,1020.231
                 2017-06-19 03:00:00,1020.231
                 2017-06-19 04:00:00,1101.231
                 2017-06-19 05:00:00,1912.231
                 2017-06-19 06:00:00,3530.231
                 2017-06-19 07:00:00,4894.231
                 2017-06-19 08:00:00,6238.231
                 2017-06-19 09:00:00,6523.231
                 2017-06-19 10:00:00,6502.231
                 2017-06-19 11:00:00,6408.231
                 2017-06-19 12:00:00,6275.000
                 2017-06-19 13:00:00,6760.000
                 2017-06-19 14:00:00,6804.000
                 2017-06-19 15:00:00,6943.000
                 2017-06-19 16:00:00,6935.000
                 2017-06-19 17:00:00,5984.000
                 2017-06-19 18:00:00,5754.000
                 2017-06-19 19:00:00,6086.000
                 2017-06-19 20:00:00,6219.000
                 2017-06-19 21:00:00,6206.000
                 2017-06-19 22:00:00,6172.000
                 2017-06-19 23:00:00,6029.000
                 2017-06-20 00:00:00,5836.000",sep=",",header=TRUE,stringsAsFactors=FALSE)
df$DateTime <- as.POSIXct(df$DateTime)


library(ggplot2)
library(lubridate)
library(scales)


ggplot(df,aes(x=df$DateTime,y=df$Val,ymin=0),xaxt="n") + 
  scale_x_datetime(labels = date_format("%m-%d"), breaks = date_breaks("days"), expand=c(0,0)) + 
  theme(text=element_text(size=10),
        legend.text=element_text(size=10)
        #,panel.background = element_rect( colour = "black")
        ) +
  geom_line(lwd=2)

weeks <- data.frame(w = seq(min(df$DateTime), max(df$DateTime), 'week'))

ggplot(df) + 
  # plot line
  geom_line(aes(x = DateTime,y=Val),lwd=0.9) +
  # plot vertical weekly lines
  geom_vline(data = weeks, 
             aes(xintercept = as.numeric(w)),
             color = 'grey55', size = 1) +
  scale_x_datetime(labels = date_format("%m-%d"),
                   breaks = date_breaks("days"),
                   # add minor breaks
                   minor_breaks = date_breaks("hours"),
                   expand = c(0,0)) +
  theme(text = element_text(size=10),
        legend.text = element_text(size=10),
        panel.background = element_rect(fill = "white", colour = "black"),
        # display daily grid
        panel.grid.major.x = element_line(color = 'grey75', size = 0.2),
        # display hourly grid
        panel.grid.minor.x = element_line(color = 'grey95', size = .01))



###############################################
df <- read.csv(url("https://raw.githubusercontent.com/ieatbaozi/R-Practicing/master/example.csv"),header = TRUE,stringsAsFactors = FALSE)
df$DateTime <- as.POSIXct(df$DateTime)

library(AnomalyDetection)
ADtest <- AnomalyDetectionTs(df, max_anoms=0.1, direction='both', plot=TRUE)
ADtest$plot


ggplot(df,aes(x=DateTime,y=Val),xaxt="n") + 
  scale_x_datetime(labels = date_format("%m-%d"), breaks = date_breaks("days"), expand=c(0,0)) + 
  theme(text=element_text(size=10),
        legend.text=element_text(size=10),
        panel.background = element_rect(fill = "white", colour = "white")) +
  geom_line()



################################################################
df <- read.table(text="
                              DateTime,Val1,Val2
                 1  ,2017-07-01 09:32:00      ,401.7542   ,275.5876
                 2  ,2017-07-01 09:30:00      ,402.7049   ,359.2615
                 3  ,2017-07-01 09:29:00      ,402.5912   ,276.4372
                 4  ,2017-07-01 09:28:00      ,402.7526   ,362.6202
                 5  ,2017-07-01 09:27:00      ,402.4538   ,361.3867
                 6  ,2017-07-01 09:26:00      ,401.8847   ,359.6318
                 7  ,2017-07-01 09:25:00      ,402.2666   ,274.8941
                 8  ,2017-07-01 09:24:00      ,403.0774   ,277.4844
                 9  ,2017-07-01 09:23:00      ,403.0516   ,363.3593
                 10 ,2017-07-01 09:22:00      ,402.5764   ,275.4202
                 11 ,2017-07-01 09:21:00      ,402.2379   ,275.0550
                 12 ,2017-07-01 09:20:00      ,401.9060   ,277.2950
                 13 ,2017-07-01 09:19:00      ,401.9451   ,361.0770
                 14 ,2017-07-01 09:18:00      ,401.4484   ,361.3591
                 15 ,2017-07-01 09:17:00      ,402.5519   ,274.8206
                 16 ,2017-07-01 09:16:00      ,402.1426   ,279.2438
                 17 ,2017-07-01 09:15:00      ,402.4618   ,360.7491
                 18 ,2017-07-01 09:14:00      ,403.3124   ,276.4756
                 19 ,2017-07-01 09:13:00      ,402.3604   ,276.7015
                 20 ,2017-07-01 09:12:00      ,402.5518   ,363.2422
                 21 ,2017-07-01 09:11:00      ,404.7830   ,360.2075
                 22 ,2017-07-01 09:10:00      ,403.7317   ,275.8560
                 23 ,2017-07-01 09:09:00      ,403.2151   ,276.8633
                 24 ,2017-07-01 09:08:00      ,404.2897   ,361.6937
                 25 ,2017-07-01 09:07:00      ,403.8227   ,355.2353
                 26 ,2017-07-01 09:06:00      ,402.8998   ,276.0700
                 27 ,2017-07-01 09:05:00      ,403.1328   ,362.2495
                 28 ,2017-07-01 09:04:00      ,404.1612   ,361.9048
                 29 ,2017-07-01 09:03:00      ,403.7537   ,274.9531
                 30 ,2017-07-01 09:02:00      ,402.1621   ,360.7682
                 31 ,2017-07-01 09:01:00      ,403.0805   ,360.8172
                 32 ,2017-07-01 09:00:00      ,403.3630   ,276.2874
                 33 ,2017-07-01 08:59:00      ,402.8351   ,275.9734
                 34 ,2017-07-01 08:58:00      ,403.6484   ,360.5585
                 35 ,2017-07-01 08:57:00      ,403.4342   ,357.7776
                 36 ,2017-07-01 08:56:00      ,402.4444   ,275.8763
                 37 ,2017-07-01 08:55:00      ,403.2913   ,361.2458
                 38 ,2017-07-01 08:54:00      ,403.2985   ,276.7728
                 39 ,2017-07-01 08:53:00      ,403.2600   ,276.6644
                 40 ,2017-07-01 08:52:00      ,401.9991   ,361.2737
                 41 ,2017-07-01 08:51:00      ,404.9158   ,358.2727
                 42 ,2017-07-01 08:50:00      ,403.8922   ,357.0592
                 43 ,2017-07-01 08:49:00      ,403.0070   ,359.5312
                 44 ,2017-07-01 08:48:00      ,404.8530   ,360.1790
                 45 ,2017-07-01 08:47:00      ,404.1543   ,359.4836
                 46 ,2017-07-01 08:46:00      ,403.9200   ,357.9064
                 47 ,2017-07-01 08:45:00      ,403.9197   ,358.6364
                 48 ,2017-07-01 08:44:00      ,406.0925   ,358.6248
                 49 ,2017-07-01 08:43:00      ,401.5529   ,359.9990
                 50 ,2017-07-01 08:42:00      ,402.4422   ,356.6060",sep=",",header=TRUE,stringsAsFactors=FALSE)
df$DateTime <- as.POSIXct(df$DateTime)
library(plotly)
library(ggplot2)
library(scales)
library(tidyr)
xy <- gather(df, key = group, value = value, -DateTime)

p <- ggplot(df, aes(DateTime)) + ylab("Val") +
  geom_line(aes(y = Val1, col = "Val1", text = paste("DateTime:", format(DateTime, "%A %T")), group = 1),lwd=0.5) + 
  geom_line(aes(y = Val2, col = "Val2", text = paste("DateTime:", format(DateTime, "%A %T")), group = 1),lwd=0.5) +
  scale_x_datetime(labels = date_format("%m-%d %H:%M"),expand = c(0,0)) +
  scale_y_continuous(expand = c(0,10))  +
  theme(text = element_text(size=9),
        axis.text.x = element_text(angle = 90, hjust = 1),
        legend.text = element_text(size=10),
        panel.background = element_rect(fill = "white", colour = "black"),
        panel.grid.major.x = element_line(color = 'grey75', size = 0.2))
ggplotly(p, tooltip = c("y","text")) %>% config(displayModeBar = FALSE) %>% layout(xaxis=list(fixedrange=TRUE)) %>% layout(yaxis=list(fixedrange=TRUE))